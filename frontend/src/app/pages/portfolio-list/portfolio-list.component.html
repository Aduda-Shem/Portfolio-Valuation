<app-loading-spinner *ngIf="loading$ | async" message="Loading portfolios..."></app-loading-spinner>

<div *ngIf="!(loading$ | async)">
  <app-page-header
    title="Portfolios"
    description="Manage your investment portfolios"
    [action]="true"
  >
    <app-button slot="action" (onClick)="toggleForm()">
      {{ showForm ? 'Cancel' : '+ New Portfolio' }}
    </app-button>
  </app-page-header>

  <app-portfolio-form
    *ngIf="showForm"
    (onSubmit)="handleCreate($event)"
    (onCancel)="showForm = false"
    class="mb-6"
  ></app-portfolio-form>

  <app-search-input
    [value]="searchTerm"
    (valueChange)="onSearchChange($event)"
    placeholder="Search portfolios..."
  ></app-search-input>

  <app-error-alert [message]="error$ | async"></app-error-alert>

  <div *ngIf="(portfolios$ | async)?.length === 0" class="mt-6">
    <app-empty-state message="No portfolios found"></app-empty-state>
  </div>

  <div
    *ngIf="(portfolios$ | async)?.length! > 0"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
  >
    <app-portfolio-card
      *ngFor="let portfolio of portfolios$ | async"
      [portfolio]="portfolio"
      (onDelete)="handleDeleteClick($event)"
    ></app-portfolio-card>
  </div>

  <app-confirm-dialog
    [isOpen]="deleteConfirm.isOpen"
    title="Delete Portfolio"
    message="Are you sure you want to delete this portfolio? This action cannot be undone."
    confirmText="Delete"
    cancelText="Cancel"
    variant="danger"
    (onConfirm)="handleDeleteConfirm()"
    (onCancel)="handleDeleteCancel()"
  ></app-confirm-dialog>
</div>

